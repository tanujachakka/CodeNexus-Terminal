<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CodeNexus Terminal</title>
    <style>
      :root {
        --bg-gradient: linear-gradient(135deg, #1f1f2e, #27293d);
        --text-color: #cfd6f7;
        --input-bg: #2e3048;
        --input-border: #5766a6;
        --prompt-color: #7aa2f7;
        --output-color: #a9b1d6;
        --logo-color: #00d4ff; /* Modern cyan for CodeNexus */
        --shadow-color: rgba(0, 0, 0, 0.5);
      }

      body {
        margin: 0;
        font-family: "Fira Code", monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: var(--bg-gradient);
        color: var(--text-color);
      }

      .container {
        width: 90%;
        max-width: 900px;
        height: 80vh;
        display: flex;
        flex-direction: column;
        background-color: #1f1f2e;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 12px 35px var(--shadow-color);
      }

      /* Sleek animated gradient logo */
      .logo {
        font-size: 36px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 10px;
        background: linear-gradient(90deg, #00d4ff, #bb9af7, #7aa2f7);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientAnimation 6s ease infinite;
      }

      @keyframes gradientAnimation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .welcome-message {
        text-align: center;
        margin-bottom: 15px;
        color: var(--text-color);
        font-size: 14px;
      }

      .terminal-output {
        flex-grow: 1;
        background: #232538;
        border-radius: 6px;
        padding: 12px;
        overflow-y: auto;
        white-space: pre-wrap;
        line-height: 1.4;
        color: var(--output-color);
        margin-bottom: 12px;
        font-family: "Fira Code", monospace;
        border: 1px solid #444867;
      }

      input {
        width: 100%;
        padding: 12px;
        background-color: var(--input-bg);
        color: var(--text-color);
        border: 1px solid var(--input-border);
        border-radius: 6px;
        font-size: 16px;
        outline: none;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
      }

      input:focus {
        border-color: var(--prompt-color);
        box-shadow: 0 0 8px rgba(122, 162, 247, 0.7);
      }

      .prompt {
        color: var(--prompt-color);
        font-weight: bold;
        margin-right: 5px;
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-thumb {
        background: #5766a6;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-track {
        background: #1f1f2e;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo">CodeNexus</div>
      <p class="welcome-message">
        Welcome to CodeNexus Terminal! Type 'help' for a list of commands.
      </p>
      <div id="out" class="terminal-output"></div>
      <form
        id="cmdform"
        onsubmit="return false;"
        style="display: flex; align-items: center"
      >
        <span id="prompt-prefix" class="prompt">codenexus@sandbox:~$</span>
        <input
          id="cmd"
          autocomplete="off"
          placeholder="Type command and press Enter"
          style="flex-grow: 1"
        />
      </form>
    </div>

    <script>
      const outEl = document.getElementById("out");
      const input = document.getElementById("cmd");
      const promptPrefixEl = document.getElementById("prompt-prefix");
      input.focus();

      async function run(cmd) {
        const res = await fetch("/run", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ command: cmd }),
        });
        const data = await res.json();
        appendOutput(
          promptPrefixEl.textContent +
            " " +
            cmd +
            "\n" +
            (data.output || "") +
            "\n"
        );
        input.value = "";
        const cwdDisplay = data.cwd === "/" ? "~" : data.cwd.replace(/^\//, "");
        promptPrefixEl.textContent = `codenexus@sandbox:${cwdDisplay}$`;
        outEl.scrollTop = outEl.scrollHeight;
      }

      function appendOutput(s) {
        outEl.textContent += s;
      }

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          run(input.value);
        }
      });

      run("");
    </script>
  </body>
</html>
